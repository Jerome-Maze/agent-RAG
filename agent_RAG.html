
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Assistant Total</title>
  <style>
    body { font-family: Arial; max-width: 600px; margin: 40px auto; }
    textarea { width: 100%; height: 100px; }
    pre { white-space: pre-wrap; background: #f4f4f4; padding: 15px; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>Assistant RAG – Alan</h2>
  <textarea id="q" placeholder="Pose ta question sur Alan H ici..."></textarea>
  <br><br>
  <button onclick="send()">Envoyer</button>
  <h3>Réponse :</h3>
  <pre id="out"></pre>

  <script>
    // ---- URL du webhook n8n (production)
<!-- const url = "https://sonicbzh.app.n8n.cloud/webhook/total-chat"; -->
  const url = "https://n8n-production-ad8e.up.railway.app/webhook/total-chat";


    // ---- SessionId persistant côté navigateur
    function getSessionId() {
      let sid = localStorage.getItem("agent_rag_sessionId");
      if (!sid) {
        sid = crypto?.randomUUID ? crypto.randomUUID() : "sid-" + Date.now() + "-" + Math.random().toString(16).slice(2);
        localStorage.setItem("agent_rag_sessionId", sid);
      }
      return sid;
    }

    async function send() {
      const sessionId = getSessionId();
      const message = document.getElementById('q').value;

      const res = await fetch(url, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ sessionId, message })    // <-- IMPORTANT
      });

      // On accepte texte ou JSON (au cas où tu renvoies un objet)
      const contentType = res.headers.get("content-type") || "";
      let text;
      if (contentType.includes("application/json")) {
        const data = await res.json();
        text = data.reply ?? JSON.stringify(data, null, 2);
      } else {
        text = await res.text();
      }

      document.getElementById('out').textContent = text;
    }
  </script>
</body>
</html>


